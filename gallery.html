<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GALLERY_VIEW // KINGSTON-115 // V3.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&family=Oswald:wght@400;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'acid-green': '#ccff00',
                        'acid-dim': 'rgba(204, 255, 0, 0.1)',
                        'dark-bg': '#050505',
                        'panel-bg': '#0a0a0a',
                    },
                    fontFamily: {
                        mono: ['"JetBrains Mono"', 'monospace'],
                        sans: ['"Oswald"', 'sans-serif'],
                    },
                    animation: {
                        'scanline': 'scanline 8s linear infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        scanline: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(100%)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* --- CORE BASE --- */
        body {
            background-color: #050505;
            color: #e5e5e5;
            font-family: 'JetBrains Mono', monospace;
            overflow-x: hidden;
            min-height: 100vh;
            /* FIXED: Removed 'perspective: 1000px;' from body.
               This property was causing position:fixed elements (like the lightbox)
               to become relative to the body instead of the viewport.
            */
        }

        /* --- 3D PERSPECTIVE GRID --- */
        .perspective-grid-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100vh;
            perspective: 600px; /* Perspective is handled here for the background */
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }
        .perspective-grid {
            position: absolute;
            top: 50%; left: -50%; width: 200%; height: 200%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 60px 60px;
            transform: rotateX(60deg) translateY(-100px) translateZ(-200px);
            transform-origin: 50% 0%;
            mask-image: linear-gradient(to bottom, transparent 0%, black 40%, transparent 90%);
            animation: gridMove 20s linear infinite;
        }
        @keyframes gridMove {
            0% { background-position: 0 0; }
            100% { background-position: 0 60px; }
        }

        /* --- NOISE & OVERLAYS --- */
        .noise-overlay {
            position: fixed; inset: 0; z-index: 50; opacity: 0.04; pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
        .scanline-overlay {
            position: fixed; inset: 0; z-index: 40; pointer-events: none;
            background-size: 100% 4px; opacity: 0.1;
            background-image: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
        }

        /* --- GALLERY ITEMS --- */
        .gallery-item-wrapper {
            perspective: 1000px; /* Item specific perspective */
            margin-bottom: 3rem;
        }
        .gallery-item {
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
            will-change: transform;
        }
        .gallery-item.idle {
            animation: float 6s ease-in-out infinite;
            animation-delay: var(--float-delay, 0s);
        }

        .gallery-item img {
            filter: grayscale(100%) contrast(110%) brightness(0.7);
            transition: filter 0.5s ease;
            box-shadow: 0 20px 50px -10px rgba(0,0,0,0.5);
            min-height: 200px; 
            background: #111;
        }
        .gallery-item:hover img {
            filter: grayscale(0%) contrast(105%) brightness(1);
            box-shadow: 0 30px 60px -12px rgba(0,0,0,0.8), 0 0 20px rgba(204, 255, 0, 0.1);
        }
        
        .item-overlay {
            position: absolute; inset: 0;
            border: 1px solid rgba(204, 255, 0, 0.3);
            opacity: 0; transition: opacity 0.3s; pointer-events: none;
            transform: translateZ(20px);
        }
        .gallery-item:hover .item-overlay { opacity: 1; }
        
        .meta-floating {
            transform: translateZ(30px);
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* --- UTILS --- */
        .scramble-text { display: inline-block; min-width: 1ch; }
        .selection-acid::selection { background-color: #ccff00; color: #000; }
        .writing-vertical-rl { writing-mode: vertical-rl; }
    </style>
</head>
<body class="selection-acid">

    <div class="noise-overlay"></div>
    <div class="scanline-overlay"></div>

    <div class="perspective-grid-container">
        <div class="perspective-grid"></div>
    </div>

    <!-- Fixed UI -->
    <div class="fixed top-6 left-6 z-50 flex flex-col gap-1 pointer-events-none mix-blend-difference text-acid-green">
        <div class="text-[10px] tracking-[0.3em] font-bold">SYS.STATUS: ONLINE</div>
        <div class="text-[10px] opacity-70" id="clock">00:00:00:00</div>
    </div>
    <div class="fixed top-6 right-6 z-50">
        <a href="javascript:history.back()" class="interactive-hover group flex items-center gap-2 text-xs font-mono text-gray-400 hover:text-acid-green transition-colors">
            <span>[ ESC ]</span>
            <span class="group-hover:translate-x-1 transition-transform">BACK_TO_ROOT</span>
        </a>
    </div>

    <main class="relative z-10 pt-32 pb-32 px-4 md:px-12 max-w-[1920px] mx-auto">

        <header class="mb-24 relative max-w-4xl" style="transform: translateZ(0);">
            <div class="absolute -left-6 top-2 bottom-2 w-[1px] bg-gradient-to-b from-acid-green to-transparent"></div>
            <div class="flex items-center gap-4 mb-4 text-acid-green/80 text-[10px] tracking-[0.2em] font-mono">
                <span class="w-4 h-4 border border-current flex items-center justify-center text-[8px] animate-pulse">R</span>
                <span>ARCHIVE_BATCH_115</span>
            </div>
            <h1 class="font-sans text-6xl md:text-8xl font-bold uppercase leading-[0.85] tracking-tight mb-8 text-white drop-shadow-2xl">
                <span class="block scramble-target" data-value="NEURAL">NEURAL</span>
                <span class="block text-transparent bg-clip-text bg-gradient-to-r from-gray-500 to-white scramble-target" data-value="SNAPSHOTS">SNAPSHOTS</span>
            </h1>
            <p class="max-w-xl text-gray-500 text-sm font-mono leading-relaxed border-l border-gray-800 pl-6 ml-1">
                > ACCESSING VISUAL MEMORY BANKS...<br>
                > RAW DATA INTERPRETATION.<br>
                > 3D RENDERING ENGINE: ACTIVE.
            </p>

            <div class="mt-12 flex flex-wrap gap-6 text-[11px] font-mono uppercase tracking-widest border-t border-dashed border-gray-800 pt-6">
                <span class="text-acid-green mr-4">Protocol:</span>
                <button class="interactive-hover filter-btn text-white relative hover:text-acid-green transition-colors" data-filter="all">[ // ALL ]</button>
                <button class="interactive-hover filter-btn text-gray-500 relative hover:text-acid-green transition-colors" data-filter="scenery">/ LANDSCAPE</button>
                <button class="interactive-hover filter-btn text-gray-500 relative hover:text-acid-green transition-colors" data-filter="portrait">/ HUMAN</button>
                <button class="interactive-hover filter-btn text-gray-500 relative hover:text-acid-green transition-colors" data-filter="urban">/ URBAN</button>
            </div>
        </header>

        <div id="loading-bar" class="w-full max-w-xs h-[1px] bg-gray-800 mb-12 relative overflow-hidden">
            <div class="absolute inset-0 bg-acid-green animate-[scanline_2s_ease-in-out_infinite] w-1/2"></div>
        </div>

        <div id="gallery-grid" class="columns-1 md:columns-2 lg:columns-3 gap-8 space-y-12 min-h-[50vh] transition-opacity duration-500 opacity-0 perspective-[2000px]">
            <!-- Items injected via JS -->
        </div>

        <footer class="mt-40 border-t border-gray-900 pt-8 flex justify-between items-end text-[10px] text-gray-600 font-mono">
            <div>
                <div class="mb-2">KINGSTON-115 // TERMINAL</div>
                <div>COPYRIGHT NULL_VOID © 2025</div>
            </div>
            <div class="text-right">
                <div class="w-24 h-8 border border-gray-800 flex items-center justify-center gap-1">
                    <div class="w-1 h-3 bg-acid-green animate-pulse"></div>
                    <div class="w-1 h-2 bg-acid-green/50"></div>
                    <div class="w-1 h-4 bg-acid-green/80"></div>
                </div>
            </div>
        </footer>

    </main>

    <!-- LIGHTBOX -->
    <div id="lightbox" class="fixed inset-0 z-[9999] bg-black/95 hidden flex items-center justify-center opacity-0 transition-opacity duration-300">
        
        <!-- Background Grid -->
        <div class="absolute inset-0 bg-[linear-gradient(rgba(204,255,0,0.05)_1px,transparent_1px),linear-gradient(90deg,rgba(204,255,0,0.05)_1px,transparent_1px)] bg-[size:40px_40px] pointer-events-none"></div>

        <!-- HUD Lines -->
        <div class="absolute top-[10%] left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-acid-green/50 to-transparent"></div>
        <div class="absolute bottom-[10%] left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-acid-green/50 to-transparent"></div>
        
        <!-- Close Control -->
        <button id="lightbox-close" class="interactive-hover absolute top-8 right-8 text-acid-green z-[10000] font-mono text-xs tracking-[0.2em] hover:bg-acid-green hover:text-black px-6 py-2 border border-acid-green transition-all cursor-pointer bg-black">
            [ CLOSE_VIEW ]
        </button>

        <!-- Container -->
        <div class="relative flex justify-center items-center p-1 border border-acid-green/30 bg-black shadow-[0_0_50px_rgba(204,255,0,0.1)]" style="max-width: 95vw; max-height: 90vh;">
            
            <!-- Tech Corners -->
            <div class="absolute -top-1 -left-1 w-4 h-4 border-l-2 border-t-2 border-acid-green z-20"></div>
            <div class="absolute -top-1 -right-1 w-4 h-4 border-r-2 border-t-2 border-acid-green z-20"></div>
            <div class="absolute -bottom-1 -right-1 w-4 h-4 border-r-2 border-b-2 border-acid-green z-20"></div>
            <div class="absolute -bottom-1 -left-1 w-4 h-4 border-l-2 border-b-2 border-acid-green z-20"></div>

            <!-- Image -->
            <img id="lightbox-img" src="" class="block object-contain relative z-10 shadow-2xl" style="max-width: 100%; max-height: 88vh; min-width: 200px; min-height: 200px;"
                 onerror="this.onerror=null; this.src='https://placehold.co/600x400/111/333?text=CORRUPT_DATA';">
            
            <!-- Metadata Side Panel -->
            <div class="absolute -right-24 top-0 bottom-0 w-20 hidden lg:flex flex-col justify-center gap-12 py-8 text-[9px] font-mono text-acid-green/60 text-right pointer-events-none border-r border-acid-green/10 pr-4">
                <div class="flex flex-col gap-2">
                    <span class="block w-2 h-2 bg-acid-green animate-pulse ml-auto"></span>
                    <span>LIVE_FEED</span>
                </div>
                <div>
                    <div class="mb-1">ISO <span class="text-white">800</span></div>
                    <div class="mb-1">AP <span class="text-white">f/1.8</span></div>
                    <div>SS <span class="text-white">1/250</span></div>
                </div>
                <div class="writing-vertical-rl transform rotate-180 tracking-[0.3em] opacity-50">
                    ENCRYPTED_DATA
                </div>
            </div>
        </div>

        <!-- Bottom Info -->
        <div class="absolute bottom-12 left-12 font-mono text-xs text-acid-green/80 flex items-center gap-4 z-[10000]">
            <span class="w-3 h-3 border border-acid-green flex items-center justify-center">
                <span class="w-1 h-1 bg-acid-green"></span>
            </span>
            <span>IMAGE_BUFFER_LOADED</span> 
        </div>
    </div>

    <script>
        const CONFIG = {
            dataSource: '/photos/gallery_code.txt',
            demoMode: true,
            scrambleSpeed: 30
        };

        const elements = {
            grid: document.getElementById('gallery-grid'),
            loader: document.getElementById('loading-bar'),
            lightbox: document.getElementById('lightbox'),
            lightboxImg: document.getElementById('lightbox-img')
        };

        // --- 3D TILT LOGIC ---
        function attachTiltEffect(card) {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const rotateX = ((y - centerY) / centerY) * -10; 
                const rotateY = ((x - centerX) / centerX) * 10;
                card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
                card.classList.remove('idle'); 
            });
            card.addEventListener('mouseleave', () => {
                card.style.transform = `rotateX(0) rotateY(0) scale(1)`;
                setTimeout(() => card.classList.add('idle'), 500); 
            });
        }

        // --- SCRAMBLE ---
        class TextScramble {
            constructor(el) {
                this.el = el;
                this.chars = '!<>-_\\/[]{}—=+*^?#________';
                this.update = this.update.bind(this);
            }
            setText(newText) {
                const oldText = this.el.innerText;
                const length = Math.max(oldText.length, newText.length);
                const promise = new Promise((resolve) => this.resolve = resolve);
                this.queue = [];
                for (let i = 0; i < length; i++) {
                    const from = oldText[i] || '';
                    const to = newText[i] || '';
                    const start = Math.floor(Math.random() * 120); 
                    const end = start + Math.floor(Math.random() * 120);
                    this.queue.push({ from, to, start, end });
                }
                cancelAnimationFrame(this.frameRequest);
                this.frame = 0;
                this.update();
                return promise;
            }
            update() {
                let output = '';
                let complete = 0;
                for (let i = 0, n = this.queue.length; i < n; i++) {
                    let { from, to, start, end, char } = this.queue[i];
                    if (this.frame >= end) {
                        complete++;
                        output += to;
                    } else if (this.frame >= start) {
                        if (!char || Math.random() < 0.28) {
                            char = this.randomChar();
                            this.queue[i].char = char;
                        }
                        output += `<span class="text-acid-green opacity-50">${char}</span>`;
                    } else {
                        output += from;
                    }
                }
                this.el.innerHTML = output;
                if (complete === this.queue.length) {
                    this.resolve();
                } else {
                    this.frameRequest = requestAnimationFrame(this.update);
                    this.frame++;
                }
            }
            randomChar() { return this.chars[Math.floor(Math.random() * this.chars.length)]; }
        }

        // --- GALLERY ---
        async function initGallery() {
            document.querySelectorAll('.scramble-target').forEach(el => {
                const fx = new TextScramble(el);
                fx.setText(el.getAttribute('data-value'));
            });
            setInterval(() => {
                const now = new Date();
                const str = now.toLocaleTimeString('en-US', { hour12: false }) + ':' + Math.floor(now.getMilliseconds()/10);
                document.getElementById('clock').innerText = str;
            }, 50);

            try {
                const response = await fetch(CONFIG.dataSource);
                if (!response.ok) throw new Error("Offline");
                const text = await response.text();
                const paths = text.split('\n').map(p => p.trim()).filter(p => p);
                renderItems(paths);
            } catch (e) {
                if (CONFIG.demoMode) renderDemoItems();
            }
        }

        function createItemHTML(src, category, delay) {
            const floatDelay = `-${Math.random() * 5}s`;
            return `
                <div class="gallery-item-wrapper break-inside-avoid opacity-0" 
                     data-category="${category}"
                     style="animation: fadeInUp 0.8s cubic-bezier(0.2, 1, 0.3, 1) forwards ${delay}ms">
                    <div class="gallery-item idle group cursor-pointer" style="--float-delay: ${floatDelay}">
                        <div class="relative bg-gray-900 border border-transparent transition-colors duration-300">
                            <div class="item-overlay z-20"></div>
                            <div class="absolute top-3 right-3 flex gap-1 z-30 opacity-0 group-hover:opacity-100 transition-opacity duration-300 meta-floating">
                                <div class="w-1 h-1 bg-acid-green rounded-full shadow-[0_0_5px_#ccff00]"></div>
                                <div class="w-1 h-1 bg-white rounded-full"></div>
                            </div>
                            <div class="absolute top-0 left-0 w-2 h-2 border-l border-t border-acid-green opacity-0 group-hover:opacity-100 transition-opacity z-20"></div>
                            <div class="absolute bottom-0 right-0 w-2 h-2 border-r border-b border-acid-green opacity-0 group-hover:opacity-100 transition-opacity z-20"></div>
                            
                            <div class="w-full h-auto bg-gray-800 min-h-[200px] relative overflow-hidden">
                                <img src="${src}" loading="lazy" class="w-full h-full object-cover block transform origin-center z-10 relative" 
                                     onerror="this.onerror=null; this.src='https://placehold.co/600x400/111/333?text=CORRUPT_DATA';">
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderItems(paths) {
            elements.loader.style.opacity = 0;
            elements.grid.style.opacity = 1;
            let html = '';
            paths.forEach((path, i) => {
                let cat = 'urban';
                const lower = path.toLowerCase();
                if (lower.includes('land')) cat = 'scenery';
                else if (lower.includes('port')) cat = 'portrait';
                html += createItemHTML(path, cat, i * 150);
            });
            elements.grid.innerHTML = html;
            attachEvents();
        }

        function renderDemoItems() {
            elements.loader.style.opacity = 0;
            elements.grid.style.opacity = 1;
            const demos = [
                {src: 'https://images.unsplash.com/photo-1531297461136-82lw9z0.jpg?auto=format&fit=crop&w=800&q=80', cat: 'urban'},
                {src: 'https://images.unsplash.com/photo-1492571350019-22de08371fd3?auto=format&fit=crop&w=800&q=80', cat: 'portrait'},
                {src: 'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?auto=format&fit=crop&w=800&q=80', cat: 'scenery'},
                {src: 'https://images.unsplash.com/photo-1515630278258-407f66498911?auto=format&fit=crop&w=800&q=80', cat: 'urban'},
                {src: 'https://images.unsplash.com/photo-1626080308314-d7868286cce2?auto=format&fit=crop&w=800&q=80', cat: 'scenery'},
                {src: 'https://images.unsplash.com/photo-1605810230434-7631ac76ec81?auto=format&fit=crop&w=800&q=80', cat: 'urban'},
            ];
            let html = '';
            [...demos, ...demos, ...demos].forEach((item, i) => {
                html += createItemHTML(item.src, item.cat, i * 150);
            });
            elements.grid.innerHTML = html;
            attachEvents();
        }

        function attachEvents() {
            const cards = document.querySelectorAll('.gallery-item');
            cards.forEach(card => {
                attachTiltEffect(card);
                const img = card.querySelector('img');
                card.addEventListener('click', () => {
                    // Check if img exists and has src
                    if (!img || !img.src) return;
                    
                    elements.lightboxImg.src = img.src;
                    
                    elements.lightbox.classList.remove('hidden');
                    void elements.lightbox.offsetWidth;
                    elements.lightbox.classList.remove('opacity-0');
                    
                    document.body.style.overflow = 'hidden';
                });
            });
        }

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const filter = e.target.dataset.filter;
                document.querySelectorAll('.filter-btn').forEach(b => {
                    b.classList.remove('text-acid-green');
                    b.classList.add('text-gray-500');
                });
                e.target.classList.remove('text-gray-500');
                e.target.classList.add('text-acid-green');

                const wrappers = document.querySelectorAll('.gallery-item-wrapper');
                wrappers.forEach(wrapper => {
                    if (filter === 'all' || wrapper.dataset.category === filter) {
                        wrapper.style.display = 'block';
                        setTimeout(() => wrapper.style.opacity = 1, 50);
                    } else {
                        wrapper.style.opacity = 0;
                        setTimeout(() => wrapper.style.display = 'none', 300);
                    }
                });
            });
        });

        const closeBox = () => {
            elements.lightbox.classList.add('opacity-0');
            setTimeout(() => { 
                elements.lightbox.classList.add('hidden'); 
                document.body.style.overflow = 'auto'; 
            }, 300);
        };
        document.getElementById('lightbox-close').addEventListener('click', closeBox);
        elements.lightbox.addEventListener('click', (e) => { 
            if (e.target === elements.lightbox) closeBox(); 
        });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeBox(); });

        window.addEventListener('DOMContentLoaded', () => { initGallery(); });

        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(60px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(styleSheet);
    </script>
</body>
</html>
